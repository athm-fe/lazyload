/*!
 * @autofe/lazyload v0.2.0
 * (c) 2018 Autohome Inc.
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):(t.AutoFE=t.AutoFE||{},t.AutoFE.Lazyload=e(t.jQuery))}(this,function(t){"use strict";var e="lazyload",n=".fe.lazyload",i=(t=t&&t.hasOwnProperty("default")?t.default:t).fn[e],o={SCROLL:"scroll"+n,RESIZE:"resize"+n},r="both",a="vertical",s="horizontal",l="above";function c(e,n){return(void 0===n.container||n.container===window?0:t(n.container)[0].getBoundingClientRect().top)>=t(e)[0].getBoundingClientRect().bottom+n.threshold}function u(e,n){return(void 0===n.container||n.container===window?0:t(n.container)[0].getBoundingClientRect().left)>=t(e)[0].getBoundingClientRect().right+n.threshold}function f(e,n){var i=void 0;void 0===n.container||n.container===window?i=window.innerHeight?window.innerHeight:t(window).height():i=t(n.container)[0].getBoundingClientRect().bottom;return i<=t(e)[0].getBoundingClientRect().top-n.threshold}function d(e,n){return(void 0===n.container||n.container===window?t(window).width():t(n.container)[0].getBoundingClientRect().right)<=t(e)[0].getBoundingClientRect().left-n.threshold}var p,h=(p=0,function(){return++p});function A(e,n){var i=this;this.options=t.extend({},A.Default,n),this.$elements=e,this.$container=t(this.options.container),this._timer=null,this._unique=h(),this._event=String(o.SCROLL)+"."+String(this._unique)+","+String(o.RESIZE)+"."+String(this._unique),this._prepareImg(),this.options.delay>=0?setTimeout(function(){i._loadDirectly()},this.options.delay):(this.bind(),t(function(){i.update()}))}function m(e){return new A(this,t.extend({},A.Default,"object"==typeof e&&e)),this}return A.Default={container:window,threshold:0,direction:a,skipInvisible:!1,failureLimit:0,delay:-1,attr:"data-src",srcsetAttr:"data-srcset",removeAttr:!0,onAppear:null,onLoad:null,onError:null,placeholder:"data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEHAAIALAAAAAABAAEAAAICVAEAOw=="},A.prototype.update=function(){var e=this,n=this.options,i=0;function o(o){i=0,o._lazyload_appear||(o._lazyload_appear=!0,n.onAppear&&n.onAppear.call(o,e.$elements.length,n),t(o).is("img")&&e._processImg(o),setTimeout(function(){var n=t.grep(e.$elements,function(t){return!t._lazyload_appear});e.$elements=t(n),e.$elements.length<=0&&e.$container.off(e._event)},100))}this.$elements.each(function(e,a){var p=t(a);if(!n.skipInvisible||p.is(":visible"))if(n.direction===r)if(c(a,n)||u(a,n));else if(f(a,n)||d(a,n)){if(++i>n.failureLimit)return!1}else o(a);else if(n.direction===s)if(u(a,n));else if(d(a,n)){if(++i>n.failureLimit)return!1}else o(a);else if(n.direction===l)if(f(a,n)){if(++i>n.failureLimit)return!1}else o(a);else if(c(a,n));else if(f(a,n)){if(++i>n.failureLimit)return!1}else o(a)})},A.prototype.bind=function(){var t=this,e=this._event;this.$container.off(e).on(e,function(){t._timer||(t._timer=setTimeout(function(){t.update(),clearTimeout(t._timer),t._timer=null},100))})},A.prototype._processImg=function(e){var n=this,i=t(e),o=this.options;if(!e._lazyloaded){var r="function"==typeof o.attr?o.attr.call(e):i.attr(o.attr),a="function"==typeof o.srcsetAttr?o.srcsetAttr.call(e):i.attr(o.srcsetAttr);t("<img />").one("load",function(){r!==i.attr("src")&&(i.hide(),i.attr("src",r),null!==a&&i.attr("srcset",a),o.removeAttr&&("string"==typeof o.attr&&i.removeAttr(o.attr),"string"==typeof o.srcsetAttr&&i.removeAttr(o.srcsetAttr)),i.show()),e._lazyloaded=!0;var s=t.grep(n.$elements,function(t){return!t._lazyloaded});n.$elements=t(s),o.onLoad&&o.onLoad.call(e,n.$elements.length,o)}).on("error",function(){o.onError&&o.onError.call(e,n.$elements.length,o)}).attr({src:r,srcset:a||""})}},A.prototype._prepareImg=function(){var e=this.options.placeholder;this.$elements.each(function(){var n=t(this);n.is("img")&&(this._lazyloaded=!1,void 0!==n.attr("src")&&!1!==n.attr("src")||n.attr("src",e))})},A.prototype._loadDirectly=function(){var e=this;this.$elements.each(function(n,i){e.options.onAppear&&e.options.onAppear.call(i,e.$elements.length,e.options),t(i).is("img")&&e._processImg(i)})},t.fn[e]=m,t.fn[e].Constructor=A,t.fn[e].noConflict=function(){return t.fn[e]=i,m},A});