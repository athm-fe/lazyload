/*!
 * @autofe/lazyload v0.2.0
 * (c) 2019 Autohome Inc.
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):(t.AutoFE=t.AutoFE||{},t.AutoFE.Lazyload=e(t.jQuery))}(this,function(s){"use strict";s=s&&s.hasOwnProperty("default")?s.default:s;var t="lazyload",e=".fe.lazyload",n=s.fn[t],i={SCROLL:"scroll"+e,RESIZE:"resize"+e},a="both",l="horizontal",c="above";function u(t,e){return(void 0===e.container||e.container===window?0:s(e.container)[0].getBoundingClientRect().top)>=s(t)[0].getBoundingClientRect().bottom+e.threshold}function f(t,e){return(void 0===e.container||e.container===window?0:s(e.container)[0].getBoundingClientRect().left)>=s(t)[0].getBoundingClientRect().right+e.threshold}function d(t,e){var n=void 0;void 0===e.container||e.container===window?n=window.innerHeight?window.innerHeight:s(window).height():n=s(e.container)[0].getBoundingClientRect().bottom;return n<=s(t)[0].getBoundingClientRect().top-e.threshold}function p(t,e){return(void 0===e.container||e.container===window?s(window).width():s(e.container)[0].getBoundingClientRect().right)<=s(t)[0].getBoundingClientRect().left-e.threshold}var o,r=(o=0,function(){return++o});function h(t,e){var n=this;this.options=s.extend({},h.Default,e),this.$elements=s(t),this.$container=s(this.options.container),this._timer=null,this._unique=r(),this._event=String(i.SCROLL)+"."+String(this._unique)+","+String(i.RESIZE)+"."+String(this._unique),this._prepareImg(),0<=this.options.delay?setTimeout(function(){n._loadDirectly()},this.options.delay):(this.bind(),s(function(){n.update()}))}function A(t){return new h(this,s.extend({},h.Default,"object"==typeof t&&t))}return h.Default={container:window,threshold:0,direction:"vertical",skipInvisible:!1,failureLimit:0,delay:-1,attr:"data-src",srcsetAttr:"data-srcset",removeAttr:!0,onAppear:null,onLoad:null,onError:null,placeholder:"data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEHAAIALAAAAAABAAEAAAICVAEAOw=="},h.prototype.update=function(){var e=this,i=this.options,o=0;function r(t){o=0,t._lazyload_appear||(t._lazyload_appear=!0,i.onAppear&&i.onAppear.call(t,e.$elements.length,i),s(t).is("img")&&e._processImg(t),setTimeout(function(){var t=s.grep(e.$elements,function(t){return!t._lazyload_appear});e.$elements=s(t),e.$elements.length<=0&&e.$container.off(e._event)},100))}this.$elements.each(function(t,e){var n=s(e);if(!i.skipInvisible||n.is(":visible"))if(i.direction===a)if(u(e,i)||f(e,i));else if(d(e,i)||p(e,i)){if(++o>i.failureLimit)return!1}else r(e);else if(i.direction===l)if(f(e,i));else if(p(e,i)){if(++o>i.failureLimit)return!1}else r(e);else if(i.direction===c)if(d(e,i)){if(++o>i.failureLimit)return!1}else r(e);else if(u(e,i));else if(d(e,i)){if(++o>i.failureLimit)return!1}else r(e)})},h.prototype.bind=function(){var t=this,e=this._event;this.$container.off(e).on(e,function(){t._timer||(t._timer=setTimeout(function(){t.update(),clearTimeout(t._timer),t._timer=null},100))})},h.prototype.destroy=function(){var t=this._event;this.$container.off(t)},h.prototype._processImg=function(e){var n=this,i=s(e),o=this.options;if(!e._lazyloaded){var r="function"==typeof o.attr?o.attr.call(e):i.attr(o.attr),a="function"==typeof o.srcsetAttr?o.srcsetAttr.call(e):i.attr(o.srcsetAttr);s("<img />").one("load",function(){r!==i.attr("src")&&(i.hide(),i.attr("src",r),null!==a&&i.attr("srcset",a),o.removeAttr&&("string"==typeof o.attr&&i.removeAttr(o.attr),"string"==typeof o.srcsetAttr&&i.removeAttr(o.srcsetAttr)),i.show()),e._lazyloaded=!0;var t=s.grep(n.$elements,function(t){return!t._lazyloaded});n.$elements=s(t),o.onLoad&&o.onLoad.call(e,n.$elements.length,o)}).on("error",function(){o.onError&&o.onError.call(e,n.$elements.length,o)}).attr({src:r,srcset:a||""})}},h.prototype._prepareImg=function(){var e=this.options.placeholder;this.$elements.each(function(){var t=s(this);t.is("img")&&(this._lazyloaded=!1,void 0!==t.attr("src")&&!1!==t.attr("src")||t.attr("src",e))})},h.prototype._loadDirectly=function(){var n=this;this.$elements.each(function(t,e){n.options.onAppear&&n.options.onAppear.call(e,n.$elements.length,n.options),s(e).is("img")&&n._processImg(e)})},s.fn[t]=A,s.fn[t].Constructor=h,s.fn[t].noConflict=function(){return s.fn[t]=n,A},h});